{% extends "base_site.html" %}

{% block title %} Plain Page {% endblock title %}

{% block stylesheets %}
    {{ super() }}
{% endblock stylesheets %}

{% block content %}
    <div class="right_col" role="main">
        <div class="">
            <div class="page-title">
                <div class="title_left">
                    <h3>Plain Page</h3>
                </div>

                <div class="title_right">
                    <div class="col-md-5 col-sm-5 col-xs-12 form-group pull-right top_search">
                        <div class="input-group">
                            <input type="text" class="form-control" placeholder="Search for...">
                            <span class="input-group-btn">
                  <button class="btn btn-default" type="button">Go!</button>
                </span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="clearfix"></div>

            <div class="row">
                <div class="col-md-12 col-sm-12 col-xs-12">
                    <div class="x_panel">
                        <div class="x_title">
                            <h2>Plain Page</h2>
                            <ul class="nav navbar-right panel_toolbox">
                                <li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
                                </li>
                                <li class="dropdown">
                                    <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button"
                                       aria-expanded="false"><i class="fa fa-wrench"></i></a>
                                    <ul class="dropdown-menu" role="menu">
                                        <li><a href="#">Settings 1</a>
                                        </li>
                                        <li><a href="#">Settings 2</a>
                                        </li>
                                    </ul>
                                </li>
                                <li><a class="close-link"><i class="fa fa-close"></i></a>
                                </li>
                            </ul>
                            <div class="clearfix"></div>
                        </div>
                        <div class="x_content">
                            <div id="sample">
                                <div id="myDiagramDiv" style="border: solid 1px black; width:100%; height:600px;"></div>
                                <p>https://www.16personalities.com/ru/test-lichnosti</p>
                                {#                                <button id="SaveButton" onclick="save()">Save</button>#}
                                {#                                <button onclick="load()">Load</button>#}
                                <button onclick="layoutAll()">Layout</button>
{#                                Diagram Model saved in JSON format:#}
                                <br/>
                                <textarea id="mySavedModel" style="width:100%;height:400px; display: none">
{ "class": "TreeModel",
  "nodeDataArray": [
{"key":0, "text":"business", "loc":"1 72", "scale":1.1},
{"text":"Soft skills", "brush":"red", "dir":"right", "parent":0, "key":-21, "loc":"77.43891601562501 83.25", "font":"bold 13px sans-serif"},
{"text":"Hard skills", "brush":"red", "dir":"left", "parent":0, "key":-22, "loc":"-18.99999999999997 83.25", "font":"bold 13px sans-serif", "scale":1.1},
{"text":"taskTracker", "brush":"skyblue", "dir":"left", "parent":-22, "key":-4, "loc":"-111.33090820312498 11.75"},
{"text":"optimisation", "brush":"red", "dir":"left", "parent":-22, "key":-5, "loc":"-111.33090820312498 154.75"},
{"text":"vsc", "brush":"skyblue", "dir":"left", "parent":-4, "key":-6, "loc":"-198.75571289062498 11.75"},
{"text":"PR", "brush":"skyblue", "dir":"left", "parent":-6, "key":-7, "loc":"-248.75571289062498 -1.25"},
{"text":"devFlow", "brush":"skyblue", "dir":"left", "parent":-6, "key":-8, "loc":"-248.75571289062498 24.75"},
{"text":"codeReview", "brush":"skyblue", "dir":"left", "parent":-7, "key":-9, "loc":"-298.755712890625 -1.25"},
{"text":"gitFlow", "brush":"skyblue", "dir":"left", "parent":-8, "key":-10, "loc":"-317.162939453125 24.75"},
{"text":"hardware", "brush":"green", "dir":"left", "parent":-5, "key":-11, "loc":"-200.69809570312498 76.75"},
{"text":"CPU", "brush":"green", "dir":"left", "parent":-11, "key":-12, "loc":"-274.894384765625 50.75"},
{"text":"RAM", "brush":"green", "dir":"left", "parent":-11, "key":-13, "loc":"-274.894384765625 76.75"},
{"text":"kernel", "brush":"green", "dir":"left", "parent":-11, "key":-14, "loc":"-274.894384765625 102.75"},
{"text":"cpuCache", "brush":"green", "dir":"left", "parent":-12, "key":-15, "loc":"-324.894384765625 50.75"},
{"text":"programmingLanguages", "brush":"coral", "dir":"left", "parent":-5, "key":-16, "loc":"-200.69809570312498 232.75"},
{"text":"archPatterns", "brush":"coral", "dir":"left", "parent":-16, "key":-17, "loc":"-361.622412109375 76.75"},
{"text":"OOP", "brush":"coral", "dir":"left", "parent":-16, "key":-18, "loc":"-361.622412109375 128.75"},
{"text":"dataTypes", "brush":"coral", "dir":"left", "parent":-16, "key":-19, "loc":"-361.622412109375 252.25"},
{"text":"algorithmes", "brush":"coral", "dir":"left", "parent":-16, "key":-20, "loc":"-361.622412109375 388.75"},
{"text":"modules", "brush":"coral", "dir":"left", "parent":-17, "key":-23, "loc":"-455.325048828125 63.75"},
{"text":"microservices", "brush":"coral", "dir":"left", "parent":-17, "key":-24, "loc":"-455.325048828125 89.75"},
{"text":"oopType", "brush":"coral", "dir":"left", "parent":-18, "key":-25, "loc":"-411.622412109375 128.75"},
{"text":"oopTemplates", "brush":"coral", "dir":"left", "parent":-25, "key":-26, "loc":"-481.502294921875 115.75"},
{"text":"oopClassic", "brush":"coral", "dir":"left", "parent":-25, "key":-27, "loc":"-481.502294921875 141.75"},
{"text":"javaOOP", "brush":"coral", "dir":"left", "parent":-27, "key":-28, "loc":"-565.086767578125 141.75"},
{"text":"crypto", "brush":"coral", "dir":"left", "parent":-20, "key":-29, "loc":"-448.818701171875 388.75"},
{"text":"symmetric", "brush":"coral", "dir":"left", "parent":-29, "key":-30, "loc":"-504.219580078125 375.75"},
{"text":"asymmetric", "brush":"coral", "dir":"left", "parent":-29, "key":-31, "loc":"-504.219580078125 401.75"},
{"text":"hashMap", "brush":"coral", "dir":"left", "parent":-19, "key":-32, "loc":"-441.614111328125 167.75"},
{"text":"array", "brush":"coral", "dir":"left", "parent":-19, "key":-33, "loc":"-441.614111328125 206.75"},
{"text":"linkedList", "brush":"coral", "dir":"left", "parent":-19, "key":-35, "loc":"-441.614111328125 245.75"},
{"text":"tree", "brush":"coral", "dir":"left", "parent":-19, "key":-36, "loc":"-441.614111328125 271.75"},
{"text":"struct", "brush":"coral", "dir":"left", "parent":-19, "key":-37, "loc":"-441.614111328125 297.75"},
{"text":"marshaling", "brush":"coral", "dir":"left", "parent":-19, "key":-38, "loc":"-441.614111328125 336.75"},
{"text":"json", "brush":"coral", "dir":"left", "parent":-38, "key":-39, "loc":"-525.198583984375 323.75"},
{"text":"protobuf", "brush":"coral", "dir":"left", "parent":-38, "key":-40, "loc":"-525.198583984375 349.75"},
{"text":"javaStruct", "brush":"coral", "dir":"left", "parent":-37, "key":-41, "loc":"-493.396826171875 297.75"},
{"text":"reverseLinkedList", "brush":"coral", "dir":"left", "parent":-35, "key":-42, "loc":"-515.810400390625 245.75"},
{"text":"javaMap", "brush":"coral", "dir":"left", "parent":-32, "key":-43, "loc":"-515.093115234375 167.75"},
{"text":"sparceMatrix", "brush":"coral", "dir":"left", "parent":-33, "key":-44, "loc":"-491.614111328125 193.75"},
{"text":"javaSlice", "brush":"coral", "dir":"left", "parent":-33, "key":-45, "loc":"-491.614111328125 219.75"},
{"text":"Тип личности", "brush":"red", "dir":"right", "parent":-21, "key":-46, "loc":"158.846142578125 83.25"},
{"text":"Аналитики", "brush":"lightcoral", "dir":"right", "parent":-46, "key":-47, "loc":"262.305126953125 -72.75"},
{"text":"Дипломаты", "brush":"darkseagreen", "dir":"right", "parent":-46, "key":-48, "loc":"262.305126953125 31.25"},
{"text":"Хранители", "brush":"skyblue", "dir":"right", "parent":-46, "key":-49, "loc":"262.305126953125 135.25"},
{"text":"Искатели", "brush":"coral", "dir":"right", "parent":-46, "key":-50, "loc":"262.305126953125 239.25"},
{"text":"Артист", "brush":"coral", "dir":"right", "parent":-50, "key":-51, "loc":"341.325634765625 200.25"},
{"text":"Делец", "brush":"coral", "dir":"right", "parent":-50, "key":-52, "loc":"341.325634765625 226.25"},
{"text":"Развлекатель", "brush":"coral", "dir":"right", "parent":-50, "key":-53, "loc":"341.325634765625 252.25"},
{"text":"Виртуоз", "brush":"coral", "dir":"right", "parent":-50, "key":-54, "loc":"341.325634765625 278.25"},
{"text":"Администратор", "brush":"skyblue", "dir":"right", "parent":-49, "key":-55, "loc":"349.031689453125 96.25"},
{"text":"Защитник", "brush":"skyblue", "dir":"right", "parent":-49, "key":-56, "loc":"349.031689453125 122.25"},
{"text":"Менеджер", "brush":"skyblue", "dir":"right", "parent":-49, "key":-57, "loc":"349.031689453125 148.25"},
{"text":"Консул", "brush":"skyblue", "dir":"right", "parent":-49, "key":-58, "loc":"349.031689453125 174.25"},
{"text":"Стратег", "brush":"lightcoral", "dir":"right", "parent":-47, "key":-59, "loc":"349.425244140625 -111.75"},
{"text":"Ученый", "brush":"lightcoral", "dir":"right", "parent":-47, "key":-60, "loc":"349.425244140625 -85.75"},
{"text":"Командир", "brush":"lightcoral", "dir":"right", "parent":-47, "key":-61, "loc":"349.425244140625 -59.75"},
{"text":"Полемист", "brush":"lightcoral", "dir":"right", "parent":-47, "key":-62, "loc":"349.425244140625 -33.75"},
{"text":"Активист", "brush":"darkseagreen", "dir":"right", "parent":-48, "key":-63, "loc":"352.706982421875 -7.75"},
{"text":"Посредник", "brush":"darkseagreen", "dir":"right", "parent":-48, "key":-64, "loc":"352.706982421875 18.25"},
{"text":"Тренер", "brush":"darkseagreen", "dir":"right", "parent":-48, "key":-65, "loc":"352.706982421875 44.25"},
{"text":"Борец", "brush":"darkseagreen", "dir":"right", "parent":-48, "key":-66, "loc":"352.706982421875 70.25"}
 ]}
  </textarea>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock content %}

{% block javascripts %}
    {{ super() }}
    <script src="{{ url_for('static', filename='vendors/go-debug.js') }}"></script>
    <script id="code">
        function init() {
            var $ = go.GraphObject.make;

            myDiagram =
                $(go.Diagram, "myDiagramDiv",
                    {
                        // when the user drags a node, also move/copy/delete the whole subtree starting with that node
                        "commandHandler.copiesTree": true,
                        "commandHandler.copiesParentKey": true,
                        "commandHandler.deletesTree": true,
                        "draggingTool.dragsTree": true,
                        "undoManager.isEnabled": true
                    });

            // when the document is modified, add a "*" to the title and enable the "Save" button
            myDiagram.addDiagramListener("Modified", function (e) {
                var button = document.getElementById("SaveButton");
                if (button) button.disabled = !myDiagram.isModified;
                var idx = document.title.indexOf("*");
                if (myDiagram.isModified) {
                    if (idx < 0) document.title += "*";
                } else {
                    if (idx >= 0) document.title = document.title.substr(0, idx);
                }
            });

            // a node consists of some text with a line shape underneath
            myDiagram.nodeTemplate =
                $(go.Node, "Vertical",
                    {selectionObjectName: "TEXT"},
                    $(go.TextBlock,
                        {
                            name: "TEXT",
                            minSize: new go.Size(30, 15),
                            editable: true
                        },
                        // remember not only the text string but the scale and the font in the node data
                        new go.Binding("text", "text").makeTwoWay(),
                        new go.Binding("scale", "scale").makeTwoWay(),
                        new go.Binding("font", "font").makeTwoWay()),
                    $(go.Shape, "LineH",
                        {
                            stretch: go.GraphObject.Horizontal,
                            strokeWidth: 3, height: 3,
                            // this line shape is the port -- what links connect with
                            portId: "", fromSpot: go.Spot.LeftRightSides, toSpot: go.Spot.LeftRightSides
                        },
                        new go.Binding("stroke", "brush"),
                        // make sure links come in from the proper direction and go out appropriately
                        new go.Binding("fromSpot", "dir", function (d) {
                            return spotConverter(d, true);
                        }),
                        new go.Binding("toSpot", "dir", function (d) {
                            return spotConverter(d, false);
                        })),
                    // remember the locations of each node in the node data
                    new go.Binding("location", "loc", go.Point.parse).makeTwoWay(go.Point.stringify),
                    // make sure text "grows" in the desired direction
                    new go.Binding("locationSpot", "dir", function (d) {
                        return spotConverter(d, false);
                    })
                );

            // selected nodes show a button for adding children
            myDiagram.nodeTemplate.selectionAdornmentTemplate =
                $(go.Adornment, "Spot",
                    $(go.Panel, "Auto",
                        // this Adornment has a rectangular blue Shape around the selected node
                        $(go.Shape, {fill: null, stroke: "dodgerblue", strokeWidth: 3}),
                        $(go.Placeholder, {margin: new go.Margin(4, 4, 0, 4)})
                    ),
                    // and this Adornment has a Button to the right of the selected node
                    $("Button",
                        {
                            alignment: go.Spot.Right,
                            alignmentFocus: go.Spot.Left,
                            click: addNodeAndLink  // define click behavior for this Button in the Adornment
                        },
                        $(go.TextBlock, "+",  // the Button content
                            {font: "bold 8pt sans-serif"})
                    )
                );

            // the context menu allows users to change the font size and weight,
            // and to perform a limited tree layout starting at that node
            myDiagram.nodeTemplate.contextMenu =
                $("ContextMenu",
                    $("ContextMenuButton",
                        $(go.TextBlock, "Bigger"),
                        {
                            click: function (e, obj) {
                                changeTextSize(obj, 1.1);
                            }
                        }),
                    $("ContextMenuButton",
                        $(go.TextBlock, "Smaller"),
                        {
                            click: function (e, obj) {
                                changeTextSize(obj, 1 / 1.1);
                            }
                        }),
                    $("ContextMenuButton",
                        $(go.TextBlock, "Bold/Normal"),
                        {
                            click: function (e, obj) {
                                toggleTextWeight(obj);
                            }
                        }),
                    $("ContextMenuButton",
                        $(go.TextBlock, "Copy"),
                        {
                            click: function (e, obj) {
                                e.diagram.commandHandler.copySelection();
                            }
                        }),
                    $("ContextMenuButton",
                        $(go.TextBlock, "Delete"),
                        {
                            click: function (e, obj) {
                                e.diagram.commandHandler.deleteSelection();
                            }
                        }),
                    $("ContextMenuButton",
                        $(go.TextBlock, "Undo"),
                        {
                            click: function (e, obj) {
                                e.diagram.commandHandler.undo();
                            }
                        }),
                    $("ContextMenuButton",
                        $(go.TextBlock, "Redo"),
                        {
                            click: function (e, obj) {
                                e.diagram.commandHandler.redo();
                            }
                        }),
                    $("ContextMenuButton",
                        $(go.TextBlock, "Layout"),
                        {
                            click: function (e, obj) {
                                var adorn = obj.part;
                                adorn.diagram.startTransaction("Subtree Layout");
                                layoutTree(adorn.adornedPart);
                                adorn.diagram.commitTransaction("Subtree Layout");
                            }
                        }
                    )
                );

            // a link is just a Bezier-curved line of the same color as the node to which it is connected
            myDiagram.linkTemplate =
                $(go.Link,
                    {
                        curve: go.Link.Bezier,
                        fromShortLength: -2,
                        toShortLength: -2,
                        selectable: false
                    },
                    $(go.Shape,
                        {strokeWidth: 3},
                        new go.Binding("stroke", "toNode", function (n) {
                            if (n.data.brush) return n.data.brush;
                            return "black";
                        }).ofObject())
                );

            // the Diagram's context menu just displays commands for general functionality
            myDiagram.contextMenu =
                $("ContextMenu",
                    $("ContextMenuButton",
                        $(go.TextBlock, "Paste"),
                        {
                            click: function (e, obj) {
                                e.diagram.commandHandler.pasteSelection(e.diagram.toolManager.contextMenuTool.mouseDownPoint);
                            }
                        },
                        new go.Binding("visible", "", function (o) {
                            return o.diagram && o.diagram.commandHandler.canPasteSelection(o.diagram.toolManager.contextMenuTool.mouseDownPoint);
                        }).ofObject()),
                    $("ContextMenuButton",
                        $(go.TextBlock, "Undo"),
                        {
                            click: function (e, obj) {
                                e.diagram.commandHandler.undo();
                            }
                        },
                        new go.Binding("visible", "", function (o) {
                            return o.diagram && o.diagram.commandHandler.canUndo();
                        }).ofObject()),
                    $("ContextMenuButton",
                        $(go.TextBlock, "Redo"),
                        {
                            click: function (e, obj) {
                                e.diagram.commandHandler.redo();
                            }
                        },
                        new go.Binding("visible", "", function (o) {
                            return o.diagram && o.diagram.commandHandler.canRedo();
                        }).ofObject()),
                    $("ContextMenuButton",
                        $(go.TextBlock, "Save"),
                        {
                            click: function (e, obj) {
                                save();
                            }
                        }),
                    $("ContextMenuButton",
                        $(go.TextBlock, "Load"),
                        {
                            click: function (e, obj) {
                                load();
                            }
                        })
                );

            myDiagram.addDiagramListener("SelectionMoved", function (e) {
                var rootX = myDiagram.findNodeForKey(0).location.x;
                myDiagram.selection.each(function (node) {
                    if (node.data.parent !== 0) return; // Only consider nodes connected to the root
                    var nodeX = node.location.x;
                    if (rootX < nodeX && node.data.dir !== "right") {
                        updateNodeDirection(node, "right");
                    } else if (rootX > nodeX && node.data.dir !== "left") {
                        updateNodeDirection(node, "left");
                    }
                    layoutTree(node);
                });
            });

            // read in the predefined graph using the JSON format data held in the "mySavedModel" textarea
            load();
        }

        function spotConverter(dir, from) {
            if (dir === "left") {
                return (from ? go.Spot.Left : go.Spot.Right);
            } else {
                return (from ? go.Spot.Right : go.Spot.Left);
            }
        }

        function changeTextSize(obj, factor) {
            var adorn = obj.part;
            adorn.diagram.startTransaction("Change Text Size");
            var node = adorn.adornedPart;
            var tb = node.findObject("TEXT");
            tb.scale *= factor;
            adorn.diagram.commitTransaction("Change Text Size");
        }

        function toggleTextWeight(obj) {
            var adorn = obj.part;
            adorn.diagram.startTransaction("Change Text Weight");
            var node = adorn.adornedPart;
            var tb = node.findObject("TEXT");
            // assume "bold" is at the start of the font specifier
            var idx = tb.font.indexOf("bold");
            if (idx < 0) {
                tb.font = "bold " + tb.font;
            } else {
                tb.font = tb.font.substr(idx + 5);
            }
            adorn.diagram.commitTransaction("Change Text Weight");
        }

        function updateNodeDirection(node, dir) {
            myDiagram.model.setDataProperty(node.data, "dir", dir);
            // recursively update the direction of the child nodes
            var chl = node.findTreeChildrenNodes(); // gives us an iterator of the child nodes related to this particular node
            while (chl.next()) {
                updateNodeDirection(chl.value, dir);
            }
        }

        function addNodeAndLink(e, obj) {
            var adorn = obj.part;
            var diagram = adorn.diagram;
            diagram.startTransaction("Add Node");
            var oldnode = adorn.adornedPart;
            var olddata = oldnode.data;
            // copy the brush and direction to the new node data
            var newdata = {text: "idea", brush: olddata.brush, dir: olddata.dir, parent: olddata.key};
            diagram.model.addNodeData(newdata);
            layoutTree(oldnode);
            diagram.commitTransaction("Add Node");

            // if the new node is off-screen, scroll the diagram to show the new node
            var newnode = diagram.findNodeForData(newdata);
            if (newnode !== null) diagram.scrollToRect(newnode.actualBounds);
        }

        function layoutTree(node) {
            if (node.data.key === 0) {  // adding to the root?
                layoutAll();  // lay out everything
            } else {  // otherwise lay out only the subtree starting at this parent node
                var parts = node.findTreeParts();
                layoutAngle(parts, node.data.dir === "left" ? 180 : 0);
            }
        }

        function layoutAngle(parts, angle) {
            var layout = go.GraphObject.make(go.TreeLayout,
                {
                    angle: angle,
                    arrangement: go.TreeLayout.ArrangementFixedRoots,
                    nodeSpacing: 5,
                    layerSpacing: 20,
                    setsPortSpot: false, // don't set port spots since we're managing them with our spotConverter function
                    setsChildPortSpot: false
                });
            layout.doLayout(parts);
        }

        function layoutAll() {
            var root = myDiagram.findNodeForKey(0);
            if (root === null) return;
            myDiagram.startTransaction("Layout");
            // split the nodes and links into two collections
            var rightward = new go.Set(/*go.Part*/);
            var leftward = new go.Set(/*go.Part*/);
            root.findLinksConnected().each(function (link) {
                var child = link.toNode;
                if (child.data.dir === "left") {
                    leftward.add(root);  // the root node is in both collections
                    leftward.add(link);
                    leftward.addAll(child.findTreeParts());
                } else {
                    rightward.add(root);  // the root node is in both collections
                    rightward.add(link);
                    rightward.addAll(child.findTreeParts());
                }
            });
            // do one layout and then the other without moving the shared root node
            layoutAngle(rightward, 0);
            layoutAngle(leftward, 180);
            myDiagram.commitTransaction("Layout");
        }

        // Show the diagram's model in JSON format
        function save() {
            document.getElementById("mySavedModel").value = myDiagram.model.toJson();
            myDiagram.isModified = false;
        }

        function load() {
            myDiagram.model = go.Model.fromJson(document.getElementById("mySavedModel").value);
        }

        init()
    </script>
{% endblock javascripts %}

